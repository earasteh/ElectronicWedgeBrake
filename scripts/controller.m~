clear;
clc;
%% Brake parameters

%% Wedge
Kcal = 44.8385e6;%6.8e6;  % Caliper's stiffness
Kpad = 3.35e7; % Brake pad stiffness
mu_cal = 0.35; % Brake fdriction coef.
Mw = 0.3; % Wedge mass
alpha = 24.5*pi/180;%12*pi/180; % angle of wedge

%% Lead screw
eta = 0.63; %71-90% motor efficiency
L_screw = 3e-3; % Lead screw
N = 1/24; % gear reduction
%% Shaft
Jm = 7.094e-3; % motor Shaft intertia

% Kax = 750e6;
% Dax = 9.3279e-5;

Kax = 750e6;
Dax = 9.3279e-5;

Dm = 1.9175e-5; % motor viscous friction

X0_caliper = 0.005; % Satuartion of the wedge distance from the disk

% DC Motor

% R_m=0.4781;
% L_m=0.0230;
% K_m=0.0157;

R_m = 0.05; % Motor resistance
L_m = 56e-6; % Motor Inductance
K_m = 0.0157;

%% Symbolic
syms  omega qax Vw qpad i_m real% States
syms Vin real% Inputs
% syms Kcal Kpad mu_cal Mw alpha eta L_screw N Jm Kax Dax Dm L_m R_m K_m real

%% Equations for the Plant


% State equations
di_m = 1/L_m * (Vin-i_m*R_m-K_m*omega);

dqax = L_screw*N/(2*pi) * omega - Vw/cos(alpha);

FM  = Kax*qax+Dax*dqax;

domega = 1/Jm * (K_m * i_m - ((L_screw*N)/(2*pi*eta))*FM - Dm*omega);

dVw = 1/(1+tan(alpha)^2)*1/Mw* (FM/cos(alpha) - ...
     (Kcal+Kpad)*qpad*tan(alpha) * (tan(alpha)+mu_cal) -...
     Kpad*qpad*tan(alpha)^2);
dqpad = Vw;


Fb = mu_cal*Kpad*qpad*tan(alpha);

%% States/Inputs/Outputs
x = [omega,qax,Vw,qpad,i_m]';
dx = [domega,dqax,dVw,dqpad,di_m]';
u = Vin;
y = omega;
%% Matrixification
% A = (jacobian(dx,x)); 
% B = (jacobian(dx,u));
% C = (jacobian(y,x));
% D = (jacobian(y,u));

A = double(jacobian(dx,x)); 
B = double(jacobian(dx,u));
C = double(jacobian(y,x));
D = double(jacobian(y,u));
%%
s = tf('s');

% syms s
% 
% Gp=C*(s*eye(5)-A)^-1*B+D;


G_m = minreal(tf(ss(A,B,C,D))); % omega_m/Vin
zpk(G_m)
pole(G_m)




